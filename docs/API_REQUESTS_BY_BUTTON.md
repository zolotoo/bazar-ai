# Запросы API по кнопкам приложения

Документ описывает, какие запросы отправляются при нажатии каждой кнопки в приложении.

---

## Легенда

| Куда | Описание |
|------|----------|
| **RapidAPI** | Instagram API через RapidAPI (instagram-scraper-20251, instagram120) |
| **Gemini** | Google Gemini API (перевод, сценарии, транскрипт каруселей) |
| **AssemblyAI** | Транскрибация аудио видео |
| **Supabase** | Локальная БД, без внешних платных API |

---

## SearchPanel (Панель поиска)

### 1. Поиск (вкладка «Поиск») — кнопка «Найти» / Enter

| Запрос | Кол-во | Куда | RapidAPI endpoint |
|--------|--------|------|-------------------|
| `searchInstagramVideos(запрос)` | 1 | RapidAPI | instagram-scraper-20251 `/searchreels` |
| `getHashtagReels(запрос)` | 0–1 | RapidAPI | instagram-scraper-20251 `/hashtag` |
| `searchInstagramVideos(запрос reels)` | 0–1 | RapidAPI | instagram-scraper-20251 `/searchreels` |
| `searchInstagramVideos(запрос viral)` | 0–1 | RapidAPI | instagram-scraper-20251 `/searchreels` |
| `searchInstagramVideos(запрос тренд)` | 0–1 | RapidAPI | instagram-scraper-20251 `/searchreels` |
| `searchInstagramVideos(запрос рилс)` | 0–1 | RapidAPI | instagram-scraper-20251 `/searchreels` |

**Итого:** 2–6 запросов в RapidAPI (instagram-scraper-20251)

- Если запрос начинается с `#` — `getHashtagReels` не вызывается.
- Вариации (`reels`, `viral`, `тренд`, `рилс`) добавляются только при длине запроса ≥ 3 символов.
- При использовании кэша за сегодня — 0 запросов.

**Примерная стоимость:** ~0,20–2 ₽ за поиск (зависит от тарифа RapidAPI, курс ~100 ₽/$)

---

### 2. Ссылка (вкладка «Ссылка») — кнопка «Добавить» / Enter

| Запрос | Кол-во | Куда | RapidAPI endpoint |
|--------|--------|------|-------------------|
| `/api/reel-info` | 1 | RapidAPI | instagram-scraper-20251 `/postdetail` |
| `/api/download-video` | 0–1 | RapidAPI | instagram120 `/api/instagram/links` (fallback) |

**Итого:** 1–2 запроса в RapidAPI

- Сначала вызывается `reel-info`. Если он не возвращает нужные данные — вызывается `download-video`.

**Примерная стоимость:** ~0,10–0,50 ₽ за ссылку

---

### 3. Радар (вкладка «Радар»)

#### 3.1. Добавить профиль — кнопка «Добавить» / Enter

| Запрос | Кол-во | Куда | RapidAPI endpoint |
|--------|--------|------|-------------------|
| `/api/user-reels` (рилсы профиля) | 1 | RapidAPI | instagram-scraper-20251 `/userreels` |
| `/api/user-reels` (статистика профиля) | 1 | RapidAPI | instagram-scraper-20251 `/userreels` |

**Итого:** 2 запроса в RapidAPI (instagram-scraper-20251)

**Примерная стоимость:** ~0,20–1 ₽ за профиль

---

#### 3.2. Обновить все — кнопка «Обновить»

| Запрос | Кол-во | Куда | RapidAPI endpoint |
|--------|--------|------|-------------------|
| `/api/user-reels` (на каждый профиль) | N | RapidAPI | instagram-scraper-20251 `/userreels` |
| `/api/user-reels` (статистика, на каждый профиль) | N | RapidAPI | instagram-scraper-20251 `/userreels` |

**Итого:** 2N запросов в RapidAPI, где N — число профилей в радаре

**Примерная стоимость:** ~0,20–1 ₽ × N (например, 5 профилей ≈ 1–5 ₽)

---

## Workspace (Рабочее пространство)

### 4. Добавить карусель по ссылке — кнопка «Добавить»

| Запрос | Кол-во | Куда | RapidAPI endpoint |
|--------|--------|------|-------------------|
| `/api/reel-info` | 1 | RapidAPI | instagram-scraper-20251 `/postdetail` |

**Итого:** 1 запрос в RapidAPI

**Примерная стоимость:** ~0,10–0,50 ₽

---

## VideoDetailPage (Страница видео)

### 5. Загрузить видео — кнопка воспроизведения

| Запрос | Кол-во | Куда | RapidAPI endpoint |
|--------|--------|------|-------------------|
| `/api/download-video` | 1 | RapidAPI | instagram120 `/api/instagram/links` |

**Итого:** 1 запрос в RapidAPI (instagram120)

**Примерная стоимость:** ~0,10–0,50 ₽

---

### 6. Перевести — кнопка «Перевести»

| Запрос | Кол-во | Куда |
|--------|--------|------|
| `/api/translate` | 1 | Gemini API |

**Итого:** 1 запрос в Gemini (не RapidAPI)

**Примерная стоимость:** ~0,01–0,10 ₽ (Gemini 2.5 Flash)

---

### 7. Сгенерировать сценарий — кнопка «По стилю» / «Сгенерировать»

| Запрос | Кол-во | Куда |
|--------|--------|------|
| `/api/translate` (если нужен перевод) | 0–1 | Gemini |
| `/api/script` | 1 | Gemini |

**Итого:** 1–2 запроса в Gemini

**Примерная стоимость:** ~0,10–1 ₽

---

### 8. Дообучение промта — кнопка «Дообучение» / «По diff»

| Запрос | Кол-во | Куда |
|--------|--------|------|
| `/api/script` | 1 | Gemini |

**Итого:** 1 запрос в Gemini

**Примерная стоимость:** ~0,10–1 ₽

---

### 9. Чат с промтом — отправка сообщения в чате

| Запрос | Кол-во | Куда |
|--------|--------|------|
| `/api/script` (action: chat) | 1 | Gemini |

**Итого:** 1 запрос в Gemini

**Примерная стоимость:** ~0,10–1 ₽

---

### 10. Рассчитать виральность — кнопка «Рассчитать виральность»

| Запрос | Кол-во | Куда | RapidAPI endpoint |
|--------|--------|------|-------------------|
| `/api/user-reels` | 1 | RapidAPI | instagram-scraper-20251 `/userreels` |

**Итого:** 1 запрос в RapidAPI (через `getOrUpdateProfileStats`)

**Примерная стоимость:** ~0,10–0,50 ₽

---

## CarouselDetailPage (Страница карусели)

### 11. Загрузить пост — кнопка обновления

| Запрос | Кол-во | Куда | RapidAPI endpoint |
|--------|--------|------|-------------------|
| `/api/reel-info` | 1 | RapidAPI | instagram-scraper-20251 `/postdetail` |

**Итого:** 1 запрос в RapidAPI

**Примерная стоимость:** ~0,10–0,50 ₽

---

### 12. Транскрибировать — кнопка «Транскрибировать»

| Запрос | Кол-во | Куда |
|--------|--------|------|
| `/api/transcribe` (imageUrls) | 1 | Gemini (2.0-flash-lite) |

**Итого:** 1 запрос в Gemini

**Примерная стоимость:** ~0,05–0,50 ₽

---

### 13. Перевести / Сгенерировать сценарий / Дообучение

Аналогично VideoDetailPage — Gemini API.

---

## Транскрибация видео (авто и ручная)

### 14. Ручная транскрибация — кнопка «Транскрибировать» на карточке видео

| Запрос | Кол-во | Куда |
|--------|--------|------|
| `/api/download-video` | 1 | RapidAPI instagram120 |
| `/api/transcribe` (audioUrl) | 1 | AssemblyAI |

**Итого:** 1 RapidAPI + 1 AssemblyAI

**Примерная стоимость:** RapidAPI ~0,10–0,50 ₽, AssemblyAI ~0,025 ₽/мин аудио

---

### 15. Автотранскрибация при добавлении видео (радар, поиск, ссылка)

Запускается в фоне при сохранении нового видео в inbox:

| Запрос | Кол-во | Куда |
|--------|--------|------|
| `/api/download-video` | 1 | RapidAPI instagram120 |
| `/api/transcribe` | 1 | AssemblyAI |

**Итого:** 1 RapidAPI + 1 AssemblyAI на каждое новое видео

---

## Сводная таблица RapidAPI

| Кнопка / Действие | RapidAPI запросов | API |
|-------------------|-------------------|-----|
| Поиск (без кэша) | 2–6 | instagram-scraper-20251 |
| Ссылка (добавить рилс) | 1–2 | instagram-scraper-20251 + instagram120 |
| Радар: добавить профиль | 2 | instagram-scraper-20251 |
| Радар: обновить все | 2N | instagram-scraper-20251 |
| Добавить карусель | 1 | instagram-scraper-20251 |
| Загрузить видео | 1 | instagram120 |
| Рассчитать виральность | 1 | instagram-scraper-20251 |
| Транскрибация видео | 1 | instagram120 |

---

## Используемые RapidAPI endpoints

| Endpoint | API | Используется в |
|----------|-----|----------------|
| `/searchreels` | instagram-scraper-20251 | Поиск по ключевому слову |
| `/hashtag/{tag}` | instagram-scraper-20251 | Поиск по хэштегу |
| `/userreels` | instagram-scraper-20251 | Радар, статистика профиля |
| `/postdetail` | instagram-scraper-20251 | Ссылка, карусель, reel-info |
| `/api/instagram/links` | instagram120 | Скачивание видео, транскрибация |

---

## Сводная таблица стоимости (в рублях)

| Кнопка / Действие | Примерная стоимость |
|------------------|---------------------|
| Поиск (без кэша) | 0,20–2 ₽ |
| Ссылка (добавить рилс) | 0,10–0,50 ₽ |
| Радар: добавить профиль | 0,20–1 ₽ |
| Радар: обновить все (5 профилей) | 1–5 ₽ |
| Добавить карусель | 0,10–0,50 ₽ |
| Загрузить видео | 0,10–0,50 ₽ |
| Перевести | 0,01–0,10 ₽ |
| Сгенерировать сценарий | 0,10–1 ₽ |
| Дообучение / Чат | 0,10–1 ₽ |
| Рассчитать виральность | 0,10–0,50 ₽ |
| Транскрибировать видео | 0,10–0,50 ₽ (AssemblyAI бесплатно) |
| Транскрибировать карусель | 0,05–0,50 ₽ |
| Обучить стиль (StyleTrainModal) | 0,50 ₽ |

---

## Система токенов (в интерфейсе)

**1 токен = 0,1 ₽** трат на API. AssemblyAI не учитывается (бесплатный тариф).

| Кнопка | Токенов |
|--------|---------|
| Поиск | 10 |
| Ссылка (добавить рилс) | 2 |
| Радар: добавить профиль | 5 |
| Радар: обновить все | 5 × N профилей |
| Добавить карусель | 2 |
| Обновить слайды карусели | 2 |
| Загрузить видео | 2 |
| Перевести | 1 |
| Сгенерировать сценарий (По стилю) | 5 |
| Дообучение промта | 5 |
| Чат с промтом | 5 |
| Рассчитать виральность | 2 |
| Транскрибировать видео | 2 |
| Транскрибировать карусель | 2 |
| Обучить стиль | 5 |

---

*Точные цены зависят от тарифа на RapidAPI. Курс пересчёта: ~100 ₽ за 1 $. Рекомендуется проверить актуальные тарифы на rapidapi.com.*
