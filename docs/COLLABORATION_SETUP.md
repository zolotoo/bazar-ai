# Инструкция по настройке системы совместной работы

## Шаг 1: Применение миграции в Supabase

Для работы системы совместной работы над проектами необходимо создать таблицы в Supabase.

### Вариант 1: Через Supabase Dashboard (рекомендуется)

1. Откройте ваш проект в [Supabase Dashboard](https://app.supabase.com)
2. Перейдите в раздел **SQL Editor**
3. Откройте файл `supabase/migrations/create_collaboration_tables.sql`
4. Скопируйте весь SQL код из файла
5. Вставьте код в SQL Editor в Supabase
6. Нажмите **Run** для выполнения миграции

### Вариант 2: Через Supabase CLI

```bash
# Если у вас установлен Supabase CLI
supabase db push
```

## Шаг 2: Проверка создания таблиц

После применения миграции проверьте, что созданы следующие таблицы:
- `project_members` - участники проектов
- `project_changes` - история изменений (Event Sourcing)
- `project_presence` - кто сейчас работает над проектом

Также будут обновлены существующие таблицы:
- `projects` - добавлены поля `owner_id`, `is_shared`, `shared_at`
- `saved_videos` - добавлены поля `last_modified_by`, `last_modified_at`, `version`

## Что делает миграция

1. **Создает таблицы для совместной работы** с правильными индексами и ограничениями
2. **Настраивает RLS (Row Level Security)** для безопасности данных
3. **Добавляет триггеры** для автоматического обновления `updated_at`
4. **Создает функции** для очистки устаревших presence записей

## После применения миграции

Система автоматически начнет работать:
- Можно приглашать участников в проекты
- Изменения синхронизируются в реальном времени
- Отображаются presence индикаторы

Если миграция не применена, приложение будет работать, но функции совместной работы будут недоступны (с graceful fallback).
